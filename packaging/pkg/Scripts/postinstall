#!/bin/bash
set -euo pipefail

# Per-user installation script for Address Cleanser
# Installs to ~/.local/bin and updates shell configuration

TARGET_ROOT="$3" # home dir in user-domain installs
DEST_DIR="$TARGET_ROOT/.local/bin"

echo "Installing Address Cleanser to $DEST_DIR..."

# Create destination directory
mkdir -p "$DEST_DIR"

# Copy binary
cp "Resources/address-cleanser" "$DEST_DIR/address-cleanser"
chmod 755 "$DEST_DIR/address-cleanser"

# Update shell configuration
SHELL_RC="$TARGET_ROOT/.zshrc"
LINE='export PATH="$HOME/.local/bin:$PATH"'

# Add to PATH if not already present
if [ -f "$SHELL_RC" ]; then
    if ! grep -qF "$LINE" "$SHELL_RC" 2>/dev/null; then
        echo "" >> "$SHELL_RC"
        echo "# Address Cleanser" >> "$SHELL_RC"
        echo "$LINE" >> "$SHELL_RC"
    fi
else
    echo "$LINE" > "$SHELL_RC"
fi

echo "âœ… Address Cleanser installed successfully!"
echo "   Binary location: $DEST_DIR/address-cleanser"
echo "   Please restart your terminal or run: source ~/.zshrc"

exit 0
